---
title: "Situación actual"
output: github_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE,
                      include = FALSE)
#Update source
rm(list = ls())
source("./RCode/collate_data.R")
load("CUSTOM/lastdate.Rdata")
load("CUSTOM/COVIDEsp.RData")
last <- max(COVIDEsp$Fecha)
Sys.setlocale("LC_TIME", "Spanish")
#Sys.setlocale("LC_TIME", "es_ES.UTF-8")
f <- format(max(COVIDEsp$Fecha), "%d %B")
source("./RCode/func_ratiohosp.R", encoding = "UTF-8")
source("./RCode/func_fallecidos.R", encoding = "UTF-8")
source("./RCode/func_all.R", encoding = "UTF-8")
source("./RCode/func_contagios.R", encoding = "UTF-8")

allfechas <- unique(COVIDEsp$Fecha)
for (j in 1:length(allfechas)){
 # AllCases(allfechas[j])
}
allfechas[j]
process <- allfechas[allfechas >= stored]



for (i in 1:length(process)) {
  RatioHosp(process[i])
  Fallecidos(process[i])
  AllCases(process[i])
  Contagios(process[i])
  stored = process[i]
  save(stored, file = "./CUSTOM/lastdate.Rdata")
}

#Crea copia de actuales
fpng <- paste0("./pngs/Fallecidos_", format(last, "%y%m%d"), ".png")
file.copy(fpng, "figs/FallecidosAct.png", overwrite = TRUE )
fpng <- paste0("./pngs/RatioHosp_", format(last, "%y%m%d"), ".png")
file.copy(fpng, "figs/RatioHospAct.png", overwrite = TRUE)
fpng <- paste0("./pngs/Casos_", format(last, "%y%m%d"), ".png")
file.copy(fpng, "figs/CasosAct.png", overwrite = TRUE)
fpng <- paste0("./pngs/Contagios_", format(last, "%y%m%d"), ".png")
file.copy(fpng, "figs/ContagiosAct.png", overwrite = TRUE)

```
*Datos publicados a `r f`*

## Últimos datos


##### Total Casos por situación en España

![](./figs/CasosAct.png)

##### Hospitalizados por 100.000 habitantes

![](./figs/RatioHospAct.png)

##### Contagios en España

![](./figs/ContagiosAct.png)

##### Fallecidos en España

![](./figs/FallecidosAct.png)

```{r gifs, message=FALSE, warning=FALSE, include=FALSE}
#Gifs
rm(list = ls())
library(magick)
pngs <- list.files("pngs/")

all <- pngs[grep("Fallec", pngs)]
f <- image_read(paste0("pngs/", all))
gif <- image_animate(f, optimize = TRUE, fps = 1, loop = 1)
image_write(gif, "figs/Fallecidos.gif")


all <- pngs[grep("RatioHosp", pngs)]
f <- image_read(paste0("pngs/", all))
gif <- image_animate(f, optimize = TRUE, fps = 1, loop = 1)
image_write(gif, "figs/RatioHosp.gif")

all <- pngs[grep("Casos", pngs)]
f <- image_read(paste0("pngs/", all))
gif <- image_animate(f, optimize = TRUE, fps = 1, loop = 1)
image_write(gif, "figs/Casos.gif")

all <- pngs[grep("Contagios", pngs)]
f <- image_read(paste0("pngs/", all))
gif <- image_animate(f, optimize = TRUE, fps = 1, loop = 1)
image_write(gif, "figs/Contagios.gif")

```

## Evolución

##### Evolución Casos en España

![](./figs/Casos.gif)


##### Evolución Hospitalizados por 100.000 habitantes

![](./figs/RatioHosp.gif)

##### Evolución Contagios en España
![](./figs/Contagios.gif)


##### Evolución Fallecidos en España

![](./figs/Fallecidos.gif)



##### Generado en `r format(Sys.time(), "%d %B %Y %H:%M:%S", usetz = TRUE, tz="CET")`
